
<div class="form-container">
    <div class="page-heading">
        <h2 class="main-title">Student Development Program</h2>
        <p class="subtitle">Create a new online mentorship program with external industry experts</p>
    </div>

    <div class="card">
        <form method="POST" action="{% url 'create_program' %}" enctype="multipart/form-data" id="programForm" novalidate>
            {% csrf_token %}
            
            <!-- Program Basic Details Section -->
            <div class="form-section">
                <div class="section-header">
                    <i class='bx bx-book-content'></i>
                    <h3>Program Details</h3>
                </div>
                <!-- existing form groups -->
            </div>
            
            <div class="form-group">
                <label for="title">Program Title*</label>
                <input type="text" class="form-control" id="title" name="title" 
                    placeholder="Enter the program title" required>
                <small class="error-message" id="title-error"></small>
            </div>

            <div class="form-group">
                <label for="category">Program Category*</label>
                <select class="form-control custom-select" id="category" name="category" required>
                    <option value="" disabled selected>Select Category</option>
                    <option value="technical">Technical Skills</option>
                    <option value="soft_skills">Soft Skills</option>
                    <option value="leadership">Leadership</option>
                    <option value="career">Career Development</option>
                    <option value="industry">Industry Specific</option>
                    <option value="other">Other</option>
                </select>
                <small class="error-message" id="category-error"></small>
                <input type="text" class="form-control mt-2" id="other_category" name="other_category" 
                    placeholder="Specify other category" style="display: none;">
                <small class="error-message" id="other_category-error"></small>
            </div>

            <!-- Mentor Details Section -->
            <div class="section-header">
                <i class='bx bx-user-voice'></i>
                <h3>Mentor Details</h3>
            </div>

            <div class="form-group">
                <label for="speaker_name">Mentor Name*</label>
                <input type="text" class="form-control" id="speaker_name" name="speaker_name" 
                    placeholder="Enter mentor's full name" required>
                <small class="error-message" id="speaker_name-error"></small>
            </div>

            <div class="form-group">
                <label for="speaker_designation">Designation*</label>
                <select class="form-control custom-select" id="speaker_designation" name="speaker_designation" required>
                    <option value="" disabled selected>Select Designation</option>
                    <option value="professor">Professor</option>
                    <option value="industry_expert">Industry Expert</option>
                    <option value="consultant">Consultant</option>
                    <option value="researcher">Researcher</option>
                    <option value="other">Other</option>
                </select>
                <small class="error-message" id="speaker_designation-error"></small>
                <input type="text" class="form-control mt-2" id="other_designation" name="other_designation" 
                    placeholder="Specify other designation" style="display: none;">
                <small class="error-message" id="other_designation-error"></small>
            </div>

            <div class="form-group">
                <label for="speaker_organization">Organization*</label>
                <input type="text" class="form-control" id="speaker_organization" name="speaker_organization" 
                    placeholder="Enter mentor's organization" required>
                <small class="error-message" id="speaker_organization-error"></small>
            </div>

            <div class="form-group">
                <label for="speaker_profile">Mentor's Profile*</label>
                <textarea class="form-control" id="speaker_profile" name="speaker_profile" rows="3" 
                    placeholder="Brief description of mentor's expertise and experience" required></textarea>
                <small class="error-message" id="speaker_profile-error"></small>
            </div>

            <div class="form-group">
                <label for="speaker_image">Mentor Photo*</label>
                <div class="image-upload-container">
                    <input type="file" class="form-control" id="speaker_image" name="speaker_image" 
                        accept=".jpg,.jpeg,.png" required>
                    <div id="image-preview" class="image-preview">
                        <img id="preview" src="#" alt="Preview" style="display: none;">
                        <div class="preview-placeholder">
                            <i class='bx bx-user'></i>
                            <span>Upload Mentor Photo</span>
                        </div>
                    </div>
                </div>
                <small class="help-text">Upload a professional photo (Max size: 5MB, Format: JPG, PNG)</small>
                <small class="error-message" id="speaker_image-error"></small>
            </div>

            <!-- Schedule Details Section -->
            <div class="section-header">
                <i class='bx bx-calendar-event'></i>
                <h3>Schedule Details</h3>
            </div>

            <div class="row">
                <div class="col-md-6 form-group">
                    <label for="start_date">Start Date*</label>
                    <input type="date" class="form-control" id="start_date" name="start_date" required>
                    <small class="error-message" id="start_date-error"></small>
                </div>
                <div class="col-md-6 form-group">
                    <label for="end_date">End Date*</label>
                    <input type="date" class="form-control" id="end_date" name="end_date" required>
                    <small class="error-message" id="end_date-error"></small>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 form-group">
                    <label for="session_time">Session Time*</label>
                    <input type="time" class="form-control" id="session_time" name="session_time" required>
                    <small class="error-message" id="session_time-error"></small>
                </div>
                <div class="col-md-6 form-group">
                    <label for="duration">Duration (in hours)*</label>
                    <input type="number" class="form-control" id="duration" name="duration" 
                        min="0.5" max="4" step="0.5" placeholder="Enter session duration" required>
                    <small class="error-message" id="duration-error"></small>
                </div>
            </div>

            <!-- Online Meeting Details Section -->
            <div class="section-header">
                <i class='bx bx-video'></i>
                <h3>Meeting Details</h3>
            </div>

            <div class="form-group">
                <label for="meeting_platform">Platform*</label>
                <select class="form-control custom-select" id="meeting_platform" name="meeting_platform" required>
                    <option value="" disabled selected>Select Platform</option>
                    <option value="google_meet">Google Meet</option>
                    <option value="zoom">Zoom</option>
                    <option value="teams">Microsoft Teams</option>
                    <option value="other">Other</option>
                </select>
                <small class="error-message" id="meeting_platform-error"></small>
                <input type="text" class="form-control mt-2" id="other_platform" name="other_platform" 
                    placeholder="Specify other platform" style="display: none;">
                <small class="error-message" id="other_platform-error"></small>
            </div>

            <div class="form-group">
                <label for="meeting_link">Meeting Link*</label>
                <input type="url" class="form-control" id="meeting_link" name="meeting_link" 
                    placeholder="Enter the meeting URL" required>
                <small class="error-message" id="meeting_link-error"></small>
            </div>

            <!-- Program Content Section -->
            <div class="section-header">
                <i class='bx bx-detail'></i>
                <h3>Program Content</h3>
            </div>

            <div class="form-group">
                <label for="description">Program Description*</label>
                <textarea class="form-control" id="description" name="description" rows="4" 
                    placeholder="Detailed description of the program" required></textarea>
                <small class="error-message" id="description-error"></small>
            </div>

            <div class="form-group">
                <label for="learning_outcomes">Learning Outcomes*</label>
                <textarea class="form-control" id="learning_outcomes" name="learning_outcomes" rows="4" 
                    placeholder="What participants will learn from this program" required></textarea>
                <small class="error-message" id="learning_outcomes-error"></small>
            </div>

            <div class="form-group">
                <label for="prerequisites">Prerequisites (if any)</label>
                <textarea class="form-control" id="prerequisites" name="prerequisites" rows="2" 
                    placeholder="Any requirements for participating in the program"></textarea>
                <small class="error-message" id="prerequisites-error"></small>
            </div>

            <div class="form-group">
                <label for="max_participants">Maximum Participants*</label>
                <input type="number" class="form-control" id="max_participants" name="max_participants" 
                    min="1" max="100" placeholder="Enter maximum number of participants" required>
                <small class="error-message" id="max_participants-error"></small>
            </div>

            <div class="btn-container">
                <button type="submit" class="btn btn-primary">
                    <i class='bx bx-plus-circle'></i> Create Program
                </button>
                <a href="{% url 'expert_dashboard' %}" class="btn btn-secondary">
                    <i class='bx bx-x-circle'></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>
<style>
    /* Form container styling */
    .form-container {
        margin-left: 280px;
        padding: 40px;
        width: 1200px;
        margin-top: -20px;
    }

    /* Main Page Heading */
    .page-heading {
        margin-bottom: 10px;
        text-align: center;
        padding: 30px 20px;
        background: linear-gradient(135deg, #2193b0, #6dd5ed);
        border-radius: 15px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 20px rgba(33, 147, 176, 0.2);
    }

    .page-heading::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        opacity: 0.6;
    }

    .main-title {
        color: white;
        font-size: 36px;
        font-weight: 800;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 2px;
        position: relative;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .subtitle {
        color: rgba(255, 255, 255, 0.95);
        font-size: 18px;
        font-weight: 500;
        position: relative;
    }

    /* Section Headers */
    .section-header {
        display: flex;
        align-items: center;
        margin: 35px 0 25px;
        padding: 20px;
        position: relative;
        background: linear-gradient(to right, #f8f9fa, #ffffff);
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .section-header::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 5px;
        background: linear-gradient(to bottom, #3498db, #2980b9);
        border-radius: 4px;
    }

    .section-header::after {
        content: '';
        position: absolute;
        right: 0;
        bottom: 0;
        width: 100px;
        height: 100%;
        background: linear-gradient(to left, rgba(52, 152, 219, 0.1), transparent);
        pointer-events: none;
    }

    .section-header:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .section-header i {
        font-size: 28px;
        background: linear-gradient(45deg, #3498db, #2980b9);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-right: 15px;
        position: relative;
    }

    .section-header h3 {
        color: #2c3e50;
        font-size: 24px;
        font-weight: 700;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 1px;
        background: linear-gradient(45deg, #2c3e50, #3498db);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        position: relative;
        background-size: 200% auto;
        animation: gradientShift 3s ease infinite;
    }

    /* Card styling */
    .card {
        box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        border: none;
        border-radius: 15px;
        background: white;
        padding: 40px;
        width: 1000px;
        margin-left: -10px;
    }

    /* Form Sections */
    .form-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        border: 1px solid rgba(52, 152, 219, 0.1);
    }

    .form-section:hover {
        box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }

    /* Form group styling */
    .form-group {
        margin-bottom: 25px;
    }

    .form-group label {
        font-weight: 600;
        color: #34495e;
        margin-bottom: 8px;
        font-size: 15px;
        display: block;
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e1e1e1;
        border-radius: 8px;
        font-size: 15px;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
    }

    .form-control:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 0.2rem rgba(52,152,219,.15);
        outline: none;
        background-color: #fff;
    }

    /* Custom select styling */
    .custom-select {
        display: block;
        width: 100%;
        height: 45px;
        padding: 8px 15px;
        font-size: 15px;
        font-weight: 400;
        line-height: 1.5;
        color: #495057;
        background-color: #fff;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23343a40' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 16px;
        border: 2px solid #e1e1e1;
        border-radius: 8px;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .custom-select:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 0.2rem rgba(52,152,219,.15);
        outline: none;
    }

    .custom-select:hover {
        border-color: #3498db;
    }

    /* Error message styling */
    .error-message {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: none;
    }

    /* Validation styling */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }

    .form-control.is-valid {
        border-color: #198754;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }

    /* Button styling */
    .btn-container {
        text-align: center;
        margin-top: 40px;
    }

    .btn {
        padding: 12px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin: 0 10px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn i {
        font-size: 20px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #2980b9, #2573a7);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
    }

    .btn-secondary {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        color: white;
        border: none;
        box-shadow: 0 4px 15px rgba(127, 140, 141, 0.3);
    }

    .btn-secondary:hover {
        background: linear-gradient(135deg, #7f8c8d, #6d7b7c);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(127, 140, 141, 0.4);
    }

    /* Animation keyframes */
    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Responsive styling */
    @media (max-width: 768px) {
        .form-container {
            margin-left: 0;
            padding: 20px;
            width: 100%;
        }

        .card {
            padding: 20px;
            width: 100%;
        }

        .row {
            flex-direction: column;
        }

        .col-md-6 {
            width: 100%;
        }

        .btn {
            width: 100%;
            margin: 10px 0;
        }

        .main-title {
            font-size: 28px;
        }
        
        .subtitle {
            font-size: 16px;
        }
        
        .section-header h3 {
            font-size: 20px;
        }
        
        .section-header i {
            font-size: 24px;
        }
    }

    .image-upload-container {
        display: flex;
        gap: 20px;
        margin-bottom: 10px;
    }

    .image-preview {
        width: 150px;
        height: 150px;
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        background: #f8f9fa;
    }

    .preview-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #6c757d;
    }

    .preview-placeholder i {
        font-size: 40px;
        margin-bottom: 8px;
    }

    .image-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: none;
    }

    .help-text {
        color: #6c757d;
        display: block;
        margin-bottom: 5px;
    }

    .error-message {
        color: #dc3545;
        display: none;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .image-upload-container {
            flex-direction: column;
            align-items: center;
        }
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const validationRules = {
            // Program Details
            title: {
                pattern: /.{3,100}/,
                message: 'Title must be between 3 and 100 characters'
            },
            category: {
                required: true,
                message: 'Please select a program category'
            },
            other_category: {
                pattern: /.{2,50}/,
                message: 'Category name must be between 2 and 50 characters',
                conditionalRequired: 'category'
            },
    
            // Mentor Details
            speaker_name: {
                pattern: /^[a-zA-Z\s.]{2,50}$/,
                message: 'Name should contain only letters, spaces, and dots (2-50 characters)'
            },
            speaker_designation: {
                required: true,
                message: 'Please select a designation'
            },
            other_designation: {
                pattern: /.{2,50}/,
                message: 'Designation must be between 2 and 50 characters',
                conditionalRequired: 'speaker_designation'
            },
            speaker_organization: {
                pattern: /.{2,100}/,
                message: 'Organization name must be between 2 and 100 characters'
            },
            speaker_profile: {
                minLength: 50,
                maxLength: 500,
                message: 'Profile description must be between 50 and 500 characters'
            },
    
            // Schedule Details
            start_date: {
                required: true,
                message: 'Please select a start date',
                custom: (value) => {
                    const today = new Date().toISOString().split('T')[0];
                    return value >= today;
                },
                customMessage: 'Start date cannot be in the past'
            },
            end_date: {
                required: true,
                message: 'Please select an end date',
                custom: (value) => {
                    const startDate = document.getElementById('start_date').value;
                    return value >= startDate;
                },
                customMessage: 'End date must be after or equal to start date'
            },
            session_time: {
                required: true,
                message: 'Please select a session time'
            },
            duration: {
                pattern: /^([0-9]*[.])?[0-9]+$/,
                custom: (value) => value >= 0.5 && value <= 4,
                message: 'Duration must be between 0.5 and 4 hours'
            },
    
            // Meeting Details
            meeting_platform: {
                required: true,
                message: 'Please select a meeting platform'
            },
            other_platform: {
                pattern: /.{2,50}/,
                message: 'Platform name must be between 2 and 50 characters',
                conditionalRequired: 'meeting_platform'
            },
            meeting_link: {
                pattern: /^https?:\/\/.+/,
                message: 'Please enter a valid URL starting with http:// or https://'
            },
    
            // Program Content
            description: {
                minLength: 100,
                maxLength: 2000,
                message: 'Program description must be between 100 and 2000 characters'
            },
            learning_outcomes: {
                minLength: 50,
                maxLength: 1000,
                message: 'Learning outcomes must be between 50 and 1000 characters'
            },
            prerequisites: {
                maxLength: 500,
                message: 'Prerequisites cannot exceed 500 characters'
            },
            max_participants: {
                pattern: /^(?:[1-9]|[1-9][0-9]|100)$/,
                message: 'Number of participants must be between 1 and 100'
            }
        };
    
        // Function to validate a single field
        function validateField(field) {
            const rule = validationRules[field.id];
            const errorElement = document.getElementById(`${field.id}-error`);
            let isValid = true;
            let errorMessage = '';
    
            // Skip validation if field is an "other" field and its parent select isn't "other"
            if (field.id.startsWith('other_')) {
                const parentSelectId = field.id.replace('other_', '');
                const parentSelect = document.getElementById(parentSelectId);
                if (parentSelect && parentSelect.value !== 'other') {
                    field.classList.remove('is-invalid', 'is-valid');
                    if (errorElement) errorElement.style.display = 'none';
                    return true;
                }
            }
    
            // Required field validation
            if (field.required && !field.value.trim()) {
                isValid = false;
                errorMessage = rule?.message || 'This field is required';
            } 
            // Conditional required validation (for "other" fields)
            else if (rule?.conditionalRequired) {
                const parentSelect = document.getElementById(rule.conditionalRequired);
                if (parentSelect?.value === 'other' && !field.value.trim()) {
                    isValid = false;
                    errorMessage = 'This field is required when "Other" is selected';
                }
            }
            // Pattern validation
            else if (rule?.pattern && !rule.pattern.test(field.value) && field.value.trim()) {
                isValid = false;
                errorMessage = rule.message;
            }
            // Length validation
            else if (field.value.trim() && (
                (rule?.minLength && field.value.length < rule.minLength) ||
                (rule?.maxLength && field.value.length > rule.maxLength)
            )) {
                isValid = false;
                errorMessage = rule.message;
            }
            // Custom validation
            else if (rule?.custom && !rule.custom(field.value) && field.value.trim()) {
                isValid = false;
                errorMessage = rule.customMessage || rule.message;
            }
    
            // Update UI
            if (errorElement) {
                errorElement.textContent = errorMessage;
                errorElement.style.display = isValid ? 'none' : 'block';
            }
    
            field.classList.toggle('is-invalid', !isValid);
            field.classList.toggle('is-valid', isValid && field.value.trim() !== '');
    
            return isValid;
        }
    
        // Add validation events to all form fields
        const inputs = form.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            ['input', 'change', 'blur'].forEach(eventType => {
                input.addEventListener(eventType, () => validateField(input));
            });
        });
    
        // Handle "Other" options in select fields
        ['category', 'speaker_designation', 'meeting_platform'].forEach(selectId => {
            const select = document.getElementById(selectId);
            const otherInput = document.getElementById(`other_${selectId}`);
            
            select.addEventListener('change', function() {
                const showOther = this.value === 'other';
                otherInput.style.display = showOther ? 'block' : 'none';
                otherInput.required = showOther;
                if (!showOther) {
                    otherInput.value = '';
                    validateField(otherInput);
                }
                validateField(this);
            });
        });
    
        // Form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            let isValid = true;
    
            // Validate all fields
            inputs.forEach(input => {
                if (!validateField(input)) {
                    isValid = false;
                }
            });
    
            // Submit if everything is valid
            if (isValid) {
                let formData = new FormData(this);
                
                fetch("{% url 'create_program' %}", {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        Swal.fire({
                            title: 'Success!',
                            text: data.message,
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.href = "{% url 'program_list' %}";
                            }
                        });
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: data.message,
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    }
                })
                .catch(error => {
                    Swal.fire({
                        title: 'Error!',
                        text: 'Something went wrong. Please try again.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                });
            } else {
                // Scroll to first error
                const firstError = form.querySelector('.is-invalid');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const imageInput = document.getElementById('speaker_image');
        const preview = document.getElementById('preview');
        const previewContainer = document.getElementById('image-preview');
        const placeholder = previewContainer.querySelector('.preview-placeholder');
        const errorElement = document.getElementById('speaker_image-error');

        async function validateImage(file) {
            return new Promise((resolve, reject) => {
                // Check file extension
                const validExtensions = ['jpg', 'jpeg', 'png'];
                const extension = file.name.split('.').pop().toLowerCase();
                if (!validExtensions.includes(extension)) {
                    reject('Please upload only JPG or PNG files');
                    return;
                }

                // Check file size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    reject('Image size must be less than 5MB');
                    return;
                }

                // Verify it's actually an image
                const img = new Image();
                const objectUrl = URL.createObjectURL(file);

                img.onload = function() {
                    URL.revokeObjectURL(objectUrl);
                    resolve(true);
                };

                img.onerror = function() {
                    URL.revokeObjectURL(objectUrl);
                    reject('Invalid image file. Please upload a valid JPG or PNG file.');
                };

                img.src = objectUrl;
            });
        }

        imageInput.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            errorElement.style.display = 'none';
            this.classList.remove('is-invalid', 'is-valid');

            if (file) {
                try {
                    await validateImage(file);
                    
                    // Show preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        placeholder.style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                    
                    this.classList.add('is-valid');
                } catch (error) {
                    preview.style.display = 'none';
                    placeholder.style.display = 'flex';
                    errorElement.textContent = error;
                    errorElement.style.display = 'block';
                    this.classList.add('is-invalid');
                    this.value = ''; // Clear the input
                }
            } else {
                preview.style.display = 'none';
                placeholder.style.display = 'flex';
            }
        });
    });
</script>